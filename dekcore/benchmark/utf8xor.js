const idGen = require( "../util/id_generator.js" );

const runlength = 1000;
var key = {key:idGen.generator(), step:0 };


var packets = [ '{short packet 1}' 
	      , '{longer pakcet, but still pretty short, maybe just a few arguments}'
	      , '[{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments}]'
	      , '[{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments}][{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments}][{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments}][{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments}][{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments}]'
	      , '[{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments}][{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments}][{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments}][{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments}][{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments}]'
               + '[{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments}][{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments}][{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments}][{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments}][{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments}]'
               + '[{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments}][{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments}][{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments}][{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments}][{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments}]'
               + '[{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments}][{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments}][{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments}][{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments}][{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments}]'
               + '[{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments}][{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments}][{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments}][{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments}][{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments}]'
               + '[{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments}][{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments}][{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments}][{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments}][{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments}]'
               + '[{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments}][{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments}][{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments}][{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments}][{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments}]'
               + '[{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments}][{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments}][{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments}][{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments}][{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments}]'
               + '[{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments}][{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments}][{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments}][{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments}][{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments}]'
               + '[{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments}][{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments}][{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments}][{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments}][{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments},{MUCH longer pakcet, but still pretty short, maybe just a few arguments}]'
	      ];

packets.forEach( p=>{
	var now = Date.now();
	var n = 0;
	var s = key.step;
	var tst = idGen.u8xor( p, key );
	key.step = s;
	var tst2 = idGen.u8xor( tst, key );
	key.step = s;
	if( tst2 !== p ) 
		throw new Error( ["String did not recode correctly:\n", JSON.stringify(key), "\n", p, "\n", tst, "\n", tst2].join() );

	while( ( n % 100 !== 0) || ( (Date.now() - now) < runlength) ) {
		n++;
		idGen.u8xor( p, key );
	}
	console.log( `encoded length ${p.length} = ${n}(${n/runlength}/ms) in ${runlength/1000} seconds (${n*p.length/runlength} chars/ms)` );
} );


var packets = [idGen.generator(),idGen.generator(),idGen.generator(),idGen.generator(),idGen.generator(),idGen.generator(),idGen.generator()];

packets.forEach( p=>{
	var now = Date.now();
	var n = 0;
	var s = key.step;
	var tst = idGen.xor( p, key.key );
	key.step = s;
	var tst2 = idGen.xor( tst, key.key );
	key.step = s;
	if( tst2 !== p ) 
		throw new Error( ["String did not recode correctly:\n", JSON.stringify(key), "\n", p, "\n", tst, "\n", tst2].join() );

	while( ( n % 100 !== 0) || ( (Date.now() - now) < runlength) ) {
		n++;
		idGen.u8xor( p, key );
	}
	console.log( `encoded length ${p.length} = ${n}(${n/runlength}/ms) in ${runlength/1000} seconds (${n*p.length/runlength} chars/ms)` );
} );
